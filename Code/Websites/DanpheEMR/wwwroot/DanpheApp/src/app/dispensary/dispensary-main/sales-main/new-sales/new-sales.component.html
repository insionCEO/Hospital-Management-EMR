<div class="hide-main patient_searchdiv" id="new-sale-page">
  <div class="Patient_search">
    <div class="row" style="display: flex; align-items: center;">
      <div class="col-md-4">
        <div class="form-group">
          <div class="row">
            <label class="control-label col-md-4 pt5 tooltip" title="ALT + F">Search Patient:<sup *ngIf="currSale.PaymentMode == 'credit'"
                   class="color-red">*</sup></label>
            <div class="col-md-8">
              <div class="autocomplete-item">
                <input *ngIf="IsCurrentDispensaryInsurace; else normalPatientSearch" id="patient-search" autocomplete="off" danphe-auto-complete
                       class="form-control" [(ngModel)]="searchPatient" [source]="AllPatientSearchAsync.bind(this)" [path-to-data]="'Results'"
                       [list-formatter]="insurancePatientListFormatter" placeholder="Search Patient (Minimum 5 Character)"
                       display-property-name="ShortName" (valueChanged)="onClickPatient($event)" value-property-name=null onClick="this.select();"
                       max-num-list="20" min-chars="{{PatientSearchMinCharacterCount}}" match-formatted="true"
                       (keyup.enter)="onPressedEnterKeyInPatientField()" [grid-sort]="'ShortName'" />
                <ng-template #normalPatientSearch>
                  <input autocomplete="off" danphe-auto-complete class="form-control" id="patient-search" [(ngModel)]="searchPatient"
                         [source]="AllPatientSearchAsync.bind(this)" [path-to-data]="'Results'" [list-formatter]="patientListFormatter"
                         placeholder="Search Patient (Minimum 5 Character)" display-property-name="ShortName" (valueChanged)="onClickPatient($event)"
                         value-property-name=null onClick="this.select();" max-num-list="20" min-chars="{{PatientSearchMinCharacterCount}}"
                         match-formatted="true" [grid-sort]="'ShortName'" (keyup.enter)="onPressedEnterKeyInPatientField()" />
                </ng-template>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-md-4 mrg">
        <div class="row no-gutters">
          <label class="control-label col-md-3 pt5">Doctor<sup>*</sup>:</label>
          <div class="col-md-9">
            <select-referrer #selectReferrer *ngIf="isReferrerLoaded" [selected-ref-id]="selectedRefId" (on-referrer-change)="onClickProvider($event)"
                             [allow-external]="true" [default-external]="false"
                             (on-enter-key-pressed-in-referrer)="coreService.FocusInputById('generic')" class="ref-er"
                             [default-referrer-info]="{AddDefaultReferrer: true, DefaultReferrerId: -1, ReferrerName: 'ANONYMOUS DOCTOR'}"
                             [reload-referrer-list]="refererListReload">
            </select-referrer>
            <button class="btn btn-success" style="margin-top: 5px;width: 25%;"
                    *ngIf="currSale.MedicalCertificateNo==null  && currSale.PrescriberId>1" (click)="OpenAddNMCPopup()"> &nbsp;&nbsp;Add
              {{GeneralFieldLabel.NMCNo}}.</button>
            <div class="row">
              <div class="col-md-12"> <span class="color-red font-sm" *ngIf="currSale.IsDirty('Prescriber')"
                      [hidden]="currSale.IsValidCheck('Prescriber','required')">Select Doctor</span> </div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-3 no-padding">
        <a *ngIf="!IsCurrentDispensaryInsurace" title="ALT+N" (click)="ShowOpPatAddPopUp()" class="patient-link"><b>Register New Outdoor
            Patient | </b></a> <a title="ALT+L" (click)="ShowStockDetails()" class="patient-link"><b>Stock Details</b></a>
      </div>
      <div class="col-md-1">
        <div class="shortcut-key shortkey-right " title="Shortcut Keys">
          <a href="#"><img src="../../../themes/theme-default/images/arrows.svg" alt=""></a>
          <div class="keydropdown">
            <ul>
              <li><kbd>ALT</kbd> + <kbd>A</kbd> = <samp>Anonymous Patient</samp> </li>
              <li><kbd>ALT</kbd> + <kbd>P</kbd> = <samp>Print Receipt</samp> </li>
              <li><kbd>ALT</kbd> + <kbd>N</kbd> = <samp>Register New Outdoor Patient</samp> </li>
              <li><kbd>ALT</kbd> + <kbd>L</kbd> = <samp>Show Stock Details</samp> </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="well">
    <div class="patient_info">
      <div class="row">
        <div class="col-sm-3 col-md-2">
          <label>Hospital No:<span
                  [innerHTML]="currentPatient.PatientCode ? currentPatient.PatientCode : newOutPatient.PatientCode ? newOutPatient.PatientCode : ''"></span></label>
        </div>
        <div class="col-sm-4 col-md-3">
          <label>Name:<span
                  [innerHTML]="currentPatient.ShortName? currentPatient.ShortName : newOutPatient.ShortName? newOutPatient.ShortName : ''"></span></label>
        </div>

        <div class="col-sm-3 col-md-2">
          <label>Age/Sex:<span
                  [innerHTML]="currentPatient.Age? currentPatient.Age: newOutPatient.Age? newOutPatient.Age : ''"></span></label>/<label><span
                  [innerHTML]="currentPatient.Gender? currentPatient.Gender: newOutPatient.Gender? newOutPatient.Gender : ''"></span></label>
        </div>

        <div class="col-sm-4 col-md-3">
          <label>Address:<span
                  [innerHTML]="currentPatient.Address?currentPatient.Address: newOutPatient.Address? newOutPatient.Address : ''"></span></label>
        </div>

        <div class="col-sm-3 col-md-2">
          <label>Contact No:<span
                  [innerHTML]="currentPatient.PhoneNumber? currentPatient.PhoneNumber: newOutPatient.PhoneNumber? newOutPatient.PhoneNumber : ''"></span></label>
        </div>
      </div>
      <div class="row sale-price-category" style="margin-top: 10px;">
        <div class="col-sm-2">
          <label>Visit Type:<span [innerHTML]="currentPatient.VisitType"></span></label>
        </div>
        <div class="col-sm-10"
             *ngIf="(SchemePriceCategoryFromVisit && SchemePriceCategoryFromVisit.SchemeId && SchemePriceCategoryFromVisit.PriceCategoryId) || DisplaySchemePriceCategorySelection">
          <scheme-pricecategory-select (on-change)="OnSchemePriceCategoryChanged($event)"
                                       [selected-scheme-priceCategory]="SchemePriceCategoryFromVisit"
                                       [service-billing-context]="serviceBillingContext" [module-name]="'Pharmacy'">
          </scheme-pricecategory-select>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-md-9">
      <div>
        <table class="table table-striped table-hover inv_table table-bordered table-form">
          <thead>
            <tr>
              <th>GenericName</th>
              <th><b>Drug/Medicine Name</b></th>
              <th><b>Expiry</b></th>
              <th><b>Batch</b></th>
              <th><b>AvlQty</b></th>
              <th><b>Qty</b></th>
              <th><b>SalePrice</b></th>
              <th><b>SubTotal</b></th>
              <th *ngIf="IsitemlevlDis && IsCurrentDispensaryInsurace == false"><b>Dis%</b></th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>
                <input danphe-auto-complete class=" form-control" id="generic" [(ngModel)]="invoiceItem.selectedGeneneric"
                       [source]="FilteredGenericList" [list-formatter]="phrmGenericListFormatter" placeholder="--Select Generic Name--"
                       display-property-name="GenericName" value-property-name=null onClick="this.select();"
                       (valueChanged)="AssignSelectedGenName(invoiceItem)" min-chars="1" [grid-sort]="'GenericName'" match-formatted="true"
                       (keyup.enter)="coreService.FocusInputById('item-box')">
              </td>

              <td [ngClass]="{'alert alert-warning':invoiceItem.IsDuplicate,'autocomplete-item':true}" style="width:200px">
                <form [formGroup]="invoiceItem.InvoiceItemsValidator" *ngIf="invoiceItem.enableItmSearch">
                  <input *ngIf="IsCurrentDispensaryInsurace; else normalItemSearch" danphe-auto-complete class="form-control"
                         [(ngModel)]="invoiceItem.selectedItem" formControlName="ItemName" [source]="ItemListWithCategoryFiltered"
                         [list-formatter]="insuranceItemListFormatter" placeholder="--Select Medicine--" display-property-name="ItemName"
                         value-property-name=null onClick="this.select();" (valueChanged)="onItemSelect($event)" max-num-list="100"
                         [min-chars]="invoiceItem.ItemFieldMinChars" style="width:250px;" id="item-box" [grid-sort]="'ItemName'"
                         match-formatted="true" (keyup.enter)="coreService.FocusInputById('qty')" autocomplete="off"
                         [ngClass]="{'border-red': invoiceItem.IsDirty('ItemName')}" />
                  <ng-template #normalItemSearch>
                    <input danphe-auto-complete class="form-control" [(ngModel)]="invoiceItem.selectedItem" formControlName="ItemName"
                           [source]="ItemListWithCategoryFiltered" [list-formatter]="phrmItemListFormatter" placeholder="--Select Medicine--"
                           display-property-name="ItemName" value-property-name=null onClick="this.select();" (valueChanged)="onItemSelect($event)"
                           max-num-list="100" [min-chars]="invoiceItem.ItemFieldMinChars" style="width:250px;" id="item-box" [grid-sort]="'ItemName'"
                           match-formatted="true"
                           (keyup.enter)="invoiceItem.selectedItem?coreService.FocusInputById('qty'): isMainDiscountAvailable && !SchemePriceCategory.DiscountPercent?  coreService.FocusInputById('discountpercent'):coreService.FocusInputById('remarks') "
                           autocomplete="off" [ngClass]="{'border-red': invoiceItem.IsDirty('ItemName')}" />
                  </ng-template>
                  <!-- <span class="error-msg" *ngIf=" invoiceItem.IsDirty('ItemName')"
                        [hidden]=" !invalid || invoiceItem.IsValidCheck('ItemName','invalidItem')">Invalid Item</span> -->
                </form>
              </td>

              <td>
                <label style="width:100px ; " min="0" type="date" value="">{{invoiceItem.ExpiryDate | date}}</label>
              </td>

              <td>
                <input [(ngModel)]="invoiceItem.BatchNo" [ngModelOptions]="{standalone: true}" style="width:80px ; " min="0" class="form-control"
                       type="text" value="" disabled>
              </td>

              <td>
                <input [(ngModel)]="invoiceItem.TotalQty" [ngModelOptions]="{standalone: true}" style="width:50px ; " min="0" class="form-control"
                       type="number" value="" disabled>
              </td>

              <td>
                <form [formGroup]="invoiceItem.InvoiceItemsValidator">
                  <input [(ngModel)]="invoiceItem.Quantity" formControlName="Quantity" style="width:50px ; " min="0" class="form-control"
                         type="number" onwheel="this.blur()" id="qty"
                         (keyup.enter)="(IsitemlevlDis&& !currSale.SchemeDiscountPercentage)? coreService.FocusInputById('dis-per') :GoToNextButton(btnadd)"
                         onClick="this.select();" onfocus="this.select();" (focusout)="OnValueChanged()"
                         [ngClass]="{'border-red': invoiceItem.IsDirty('Quantity')}">
                  <!-- <span class="error-msg" *ngIf="invoiceItem.IsDirty('Quantity')"
                        [hidden]="(invoiceItem.TotalQty>=invoiceItem.Quantity)">Sales
                    Qty Should be less than Total Qty</span>
                  <span class="color-red font-sm" *ngIf="invalid ||invoiceItem.IsDirty('Quantity')"
                        [hidden]="invoiceItem.IsValidCheck('Quantity','invalidNumber')">Not Valid quantity</span>

                  <span class="color-red font-sm" *ngIf="invalid ||invoiceItem.IsDirty('Quantity')"
                        [hidden]="invoiceItem.IsValidCheck('Quantity','wrongDecimalValue')">Required Whole Number</span> -->
                </form>
              </td>

              <td>
                <input [(ngModel)]="invoiceItem.SalePrice" [ngModelOptions]="{standalone: true}" style="width:70px ; " min="0" class="form-control"
                       type="number" value="" disabled>
              </td>

              <td>
                {{invoiceItem.SubTotal | number: "1.0-2"}}
              </td>

              <td *ngIf="IsitemlevlDis">
                <form [formGroup]="invoiceItem.InvoiceItemsValidator">
                  <input [(ngModel)]="invoiceItem.DiscountPercentage" id="dis-per" formControlName="DiscountPercentage" style="width:50px ; "
                         onClick="this.select();" min="0" class="form-control" type="number" (focusout)="OnValueChanged()"
                         (keyup.enter)="GoToNextButton(btnadd)" [attr.disabled]="currSale.SchemeDiscountPercentage?true: null">
                  <span class="color-red font-sm" *ngIf="invoiceItem.IsDirty('DiscountPercentage')"
                        [hidden]="invoiceItem.IsValidCheck('DiscountPercentage','required') && invoiceItem.IsValidCheck('DiscountPercentage','min') && invoiceItem.IsValidCheck('DiscountPercentage','max')">Discount
                    % Range: 0-100%</span>
                </form>
              </td>
              <td>
                <button type="button" #btnadd id="btn-add" class="btn green btn-success" (click)="AddSaleItem()"
                        (keyup.enter)="coreService.FocusInputById('item-box')">
                  <i class="fa fa-plus"></i></button>
              </td>
            </tr>
          </tbody>
        </table>
        <form [formGroup]="invoiceItem.InvoiceItemsValidator">
          <div class="error-message alert alert-danger error-message-alert"
               *ngIf="(invoiceItem.IsDirty('Quantity')) || (invoiceItem.IsDirty('ItemName'))">
            <span
                  [hidden]="(invoiceItem.TotalQty>=invoiceItem.Quantity) || (invoiceItem.IsValidCheck('Quantity','invalidNumber')) || (invoiceItem.IsValidCheck('Quantity','wrongDecimalValue'))">
              Invalid Quantity</span>
            <span [hidden]=" !invalid || invoiceItem.IsValidCheck('ItemName','invalidItem')">
              Invalid Item</span>
          </div>
        </form>
        <div class="table-wrap">
          <table class="table table-bordered">
            <thead>
              <tr>
                <th></th>
                <th>#</th>
                <th>GenericName</th>
                <th>ItemName</th>
                <th>Expiry</th>
                <th>Batch</th>
                <th>Qty</th>
                <th>SalePrice</th>
                <th>SubTotal</th>
                <th>Discount Amt.</th>
                <th>VAT Amt.</th>
                <th>Total</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let item of currSaleItems; let i = index">
                <td>
                  <a class="btn btn-danger" (click)="RemoveInvoiceItem(i)" title="Click to remove this item">
                    <i class="fa fa-times"></i></a>
                </td>
                <td>{{i + 1}}</td>
                <td>{{item.GenericName}}</td>
                <td>{{item.ItemName}}</td>
                <td>{{item.ExpiryDate | date: 'MMM yyy'}}</td>
                <td>{{item.BatchNo}}</td>
                <td>{{item.Quantity}}</td>
                <td>{{item.SalePrice | number: "1.2-4"}}</td>
                <td>{{item.SubTotal | number: "1.2-4"}}</td>
                <td>{{item.TotalDisAmt | number: "1.2-4"}}</td>
                <td>{{item.VATAmount | number: "1.2-4"}}</td>
                <td>{{item.TotalAmount | number: "1.2-4"}}</td>
              </tr>

            </tbody>
          </table>
        </div>
      </div>
    </div>

    <div class="col-md-3">
      <div class="bg-white p-15">
        <table class="accountinfo">
          <!-- <tr>
                                                                                                                          <div class="form-check">
                                                                                                                            <input type="checkbox" [(ngModel)]="IsProvisionalAllowed" class="form-check-input" id="allow-provisional">
                                                                                                                            <label class="form-check-label" for="allow-provisional">Provisional</label>
                                                                                                                          </div>
                                                                                                                        </tr> -->
          <tr>
            <td>Sub Total:</td>
            <td>
              <div class="form-group">
                <input onwheel="this.blur()" class="form-control" [ngModelOptions]="{standalone: true}" [(ngModel)]="currSale.SubTotal" disabled
                       id="subtotal" name="subtotal" type="number">
              </div>
            </td>
          </tr>
          <tr *ngIf="isMainDiscountAvailable">
            <td>Discount Percentage:</td>
            <td>
              <div class="form-group">
                <form [formGroup]="currSale.InvoiceValidator">
                  <input onwheel="this.blur()" onClick="this.select();" class="form-control" formControlName="DiscountPer"
                         [(ngModel)]="currSale.DiscountPer" (focusout)="MainLevelCalculation(currSale.DiscountPer,0)" id="discountpercent"
                         name="discountpercent" type="number" (keyup.enter)="coreService.FocusInputById('discountamount')"
                         [attr.disabled]="currSale.SchemeDiscountPercentage?true: null">
                  <span class="color-red font-sm" *ngIf="currSale.IsDirty('DiscountPer')"
                        [hidden]="currSale.IsValidCheck('DiscountPer','required') && currSale.IsValidCheck('DiscountPer','min') && currSale.IsValidCheck('DiscountPer','max')">Discount
                    % Range: 0-100%</span>
                </form>
              </div>
            </td>
          </tr>
          <tr *ngIf="isMainDiscountAvailable">
            <td>Discount Amount: </td>
            <td>
              <div class="form-group">
                <input onwheel="this.blur()" onClick="this.select();" class="form-control" [ngModelOptions]="{standalone: true}"
                       [(ngModel)]="currSale.DiscountAmount" (focusout)="MainLevelCalculation(0,currSale.DiscountAmount)" id="discountamount"
                       name="discountamount" type="number"
                       (keyup.enter)="currSale.CoPaymentMode == 'credit' ? coreService.FocusInputById('remarks') : coreService.FocusInputById('Tender')"
                       [disabled]="currSale.SchemeDiscountPercentage">
              </div>
            </td>
          </tr>
          <tr *ngIf="isMainVATApplicable == true">
            <td>VAT Amount: </td>
            <td>
              <div class="form-group">
                <input onwheel="this.blur()" class="form-control" [ngModelOptions]="{standalone: true}" disabled [(ngModel)]="currSale.VATAmount"
                       id="total-vat-amount" name="vat-amount" type="number">
              </div>
            </td>
          </tr>
          <tr>
            <td>Total Amount:</td>
            <td>
              <div class="form-group">
                <input onwheel="this.blur()" [(ngModel)]="currSale.TotalAmount" [ngModelOptions]="{standalone: true}" disabled class="form-control"
                       name="TotalAmount" type="number">
              </div>
            </td>
          </tr>
          <tr class="dot">
            <td colspan="2" class="text-capitalize">In Words : <b>{{currSale.PaidAmount | number: "1.2-4" | NumberInWords}}
              </b>Only. <br />
              <br />
            </td>
          </tr>
          <tr *ngIf="currSale.IsCoPayment">
            <td>Payment Mode: </td>
            <td>
              <div class="form-group">
                <input type="text" class="form-control" [(ngModel)]="currSale.CoPaymentMode" disabled>
              </div>
            </td>
          </tr>
          <tr *ngIf="currSale.IsCoPayment">
            <td>
              CASH:
            </td>
            <td>
              <input disabled [(ngModel)]="currSale.ReceivedAmount"
                     style="font-weight:bold;height: 40px;font-size:30px !important;background-color:#0773bc; color:#fff;margin-bottom: 3px;"
                     class="form-control" name="cash" type="number" (wheel)="coreService.PreventNumberChangeOnScroll($event)" onclick="this.select();"
                     [disabled]="currSale.IsCoPayment ? null : true" (focusout)="ReceivedAmountChange()">
              <div class="text-right"><button
                        *ngIf="currSale.IsCoPayment && currSale.CoPaymentCreditAmount==0 && currSale.CoPaymentMode=='cash' && !discountOnPhrmSaleEnable "
                        type="button" class="btn btn-success" (click)="ReCalculateCOPaymentAmount()">ReCalculate</button>
              </div>
            </td>
          </tr>
          <tr *ngIf="currSale.IsCoPayment">
            <td>CoPayment Information: </td>
            <td>
              <div class="form-group">
                <span>CoPayCashAmt: {{currSale.CoPaymentCashAmount}} </span> <br>
                <span> CoPayCreditAmt:
                  {{currSale.CoPaymentCreditAmount}}</span>
              </div>
            </td>
          </tr>
          <tr>
            <td colspan="2">
              <payment-mode-info [deposit-balance]="patSummary.DepositBalance" [total-amount]="currSale.ReceivedAmount"
                                 [default-payment-mode]="SchemePriceCategory.DefaultPaymentMode" [page-name]="'NewSale'"
                                 [is-coPayment]="SchemePriceCategory.IsCoPayment" [is-credit-only-scheme]="SchemePriceCategory.IsCreditOnlyScheme"
                                 [is-allAmountPaidByPatient]="IsAllAmountPaidByPatient" (on-paymentMode-change)="PaymentModeChanges($event)"
                                 [default-credit-organization]="SchemePriceCategory.DefaultCreditOrganizationId"
                                 (on-creditOrganization-change)="CreditOrganizationChanges($event)" [show-deduct-from-deposit]="'true'"
                                 (on-multiple-paymentMode)="MultiplePaymentCallBack($event)"
                                 [disable-paymentMode-dropdown]="DisablePaymentModeDropDown">
              </payment-mode-info>
            </td>
          </tr>
          <tr *ngIf="currSale.CoPaymentMode!=='credit'"
              [hidden]="(IsCurrentDispensaryInsurace == true && currSale.PaymentMode == 'credit')||(currSale.PaymentMode == 'credit')">
            <td>Tender:</td>
            <td>
              <div class="form-group">
                <input #tender onwheel="this.blur()" onClick="this.select();" class="form-control" [ngModelOptions]="{standalone: true}"
                       [disabled]="currSale.PaymentMode == 'credit'" [(ngModel)]="currSale.Tender" (ngModelChange)="ChangeTenderAmount()" id="Tender"
                       name="tender" type="number" (keyup.enter)="GoToNextButton(printInvoice)">
              </div>
            </td>
          </tr>
          <tr *ngIf="currSale.CoPaymentMode!=='credit'"
              [hidden]="(IsCurrentDispensaryInsurace == true && currSale.PaymentMode == 'credit'||(currSale.PaymentMode == 'credit'))">
            <td>Change:</td>
            <td>{{coreService.currencyUnit}} {{currSale.Change}}</td>
          </tr>
          <tr>
            <td>Remarks:<sup *ngIf="currSale.PaymentMode == 'credit' || isRemarksMandatory" class="color-red">*</sup></td>
            <td>
              <div class="form-group">
                <input [(ngModel)]="currSale.Remark" [ngModelOptions]="{standalone: true}" class="form-control" name="Remarks" id="remarks"
                       (keyup.enter)="GoToNextButton(printInvoice)" type="text">
              </div>
            </td>
          </tr>
          <tr [hidden]="IsCurrentDispensaryInsurace == true">
            <td>Paid Amount: <i class="glyphicon glyphicon-hand-right blink" style="color:red;font-size:10px;"></i></td>
            <td>
              <div class="form-group">
                <input [(ngModel)]="currSale.PaidAmount" [ngModelOptions]="{standalone: true}" class="form-control blink" name="PaidAmount"
                       type="number" disabled>
              </div>
            </td>
          </tr>
        </table>
        <div style="display: flex; justify-content: flex-end; margin-top: 20px;">
          <input DanpheConfirmationDialog type="submit" [title]="confirmationTitle" [message]="confirmationMessage" (confirm)="handleConfirm()"
                 (cancel)="handleCancel()" #printInvoice class="btn green btn-success tooltip" title="ALT + P" [disabled]="loading"
                 value="Print Invoice">
          <span></span>&nbsp;&nbsp;&nbsp;
          <input *ngIf="SchemePriceCategory.AllowProvisionalBilling && currentPatient.PatientId >0" DanpheConfirmationDialog type="submit"
                 [title]="confirmationTitle" [message]="confirmationMessageForProvisional" (confirm)="handleProvisionalSaleConfirm()"
                 (cancel)="handleCancel()" #printInvoice class="btn green btn-success tooltip" [disabled]="loading" value="Provisional Slip">
          <button class="btn btn-danger" [disabled]="loading" (click)="Cancel()">
            Discard
          </button>
        </div>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-md-2">
      <div class="invoice-history" [hidden]="IsCurrentDispensaryInsurace == true">
        <div class="history-title"> <b>Invoice History</b> </div>
        <table>
          <tr>
            <td>Deposit Balance <b class="colon">:</b></td>
            <td>{{patSummary.DepositBalance}}</td>
          </tr>
          <tr>
            <td>Credit <b class="colon">:</b></td>
            <td style="text-decoration:underline;">{{patSummary.CreditAmount}}</td>
          </tr>
          <tr>
            <td>Provisional Amount <b class="colon">:</b></td>
            <td style="text-decoration:underline;">{{patSummary.ProvisionalAmt}}</td>
          </tr>
          <tr>
            <td>Total Due<b class="colon">:</b></td>
            <td>{{patSummary.TotalDue}}</td>
          </tr>
          <tr>
            <td>Balance Amount <b class="colon">:</b></td>
            <td style="font-weight: bold;color: red;font-size: 17px;"> {{patSummary.BalanceAmount}} </td>
          </tr>
        </table>
      </div>
    </div>
    <div class="col-md-2">
      <div class="invoice-history" [hidden]="IsCurrentDispensaryInsurace == true">
        <div class="history-title"> <b>Credit Limits and Balances</b> </div>
        <table>
          <tr>
            <td>General Credit Limit<b class="colon">:</b></td>
            <td>{{patSummary.GeneralCreditLimit}}</td>
          </tr>
          <tr>
            <td>IP Credit Limit<b class="colon">:</b></td>
            <td>{{patSummary.IpCreditLimit}}</td>
          </tr>
          <tr>
            <td>OP Credit Limit<b class="colon">:</b></td>
            <td>{{patSummary.OpCreditLimit}}</td>
          </tr>
          <tr>
            <td>IP Balance<b class="colon">:</b></td>
            <td>{{patSummary.IpBalance}}</td>
          </tr>
          <tr>
            <td>OP Balance<b class="colon">:</b></td>
            <td>{{patSummary.OpBalance}}</td>
          </tr>

        </table>
      </div>
    </div>
  </div>




  <!-- @*End:- Sale*@ -->
  <!-- @*Start:- PopUp Modal For Doctor and NMC in case of Narcotic sales (Narcotics Record)*@ -->
  <!--Model Box Starting Here-->
  <div class="popup-static portlet box portlet-fullscreen" *ngIf="showSupplierAddPage">
    <div class="portlet-body form" style="background-color:white">
      <!--Model Box Body Start-->
      <form class="form-horizontal">
        <div class="form-body">
          <div class="col-md-12">
            <div class="col-md-2 hidden-xs hidden-sm" style="margin-right: 24px;"> </div>
            <div class="col-md-8 col-sm-12 col-xs-12 modelbox-div" style="margin-right: 24px;">
              <br />
              <div class="col-md-12">
                <div class="col-md-6">
                  <div class="form-group">
                    <label class="control-label col-md-4">Patient Name<b class="color-red"> *</b><b style="float:right;">:</b></label>
                    <div class="col-md-8">
                      <input class="form-control" type="text" maxlength="50" [(ngModel)]="narcoticsRecord.BuyerName" value=""
                             [ngModelOptions]="{standalone: true}" placeholder="Enter Patient Name" required />
                    </div>
                  </div>
                  <div class="form-group">
                    <label class="control-label col-md-4">Refill</label>
                    <div class="col-md-8">
                      <input class="form-control" type="text" maxlength="10" [(ngModel)]="narcoticsRecord.Refill" value=""
                             [ngModelOptions]="{standalone: true}" placeholder="Enter Refill" />
                    </div>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-group">
                    <label class="control-label col-md-4">Doctor Name<b class="color-red"> *</b><b style="float:right;">:</b></label>
                    <div class="col-md-8">
                      <input class="form-control" type="text" maxlength="30" [(ngModel)]="narcoticsRecord.DoctorName"
                             [ngModelOptions]="{standalone: true}" value="" placeholder="Enter Doctor's Name" />
                    </div>
                  </div>
                  <div class="form-group">
                    <label class="control-label col-md-4">{{GeneralFieldLabel.NMCNo}}<b class="color-red"> *</b><b style="float:right;">:</b></label>
                    <div class="col-md-8">
                      <input class="form-control" type="text" maxlength="100" [(ngModel)]="narcoticsRecord.NMCNumber"
                             [ngModelOptions]="{standalone: true}" value="" placeholder="{{GeneralFieldLabel.NMCNo}}" />
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-md-12" style="padding-bottom: 18px;">
                <div class="form-actions">
                  <input type="button" class="btn btn-primary" (click)="SaveNarcotics()" value="Add" />
                </div>
              </div>
            </div>
            <div class="col-md-2 hidden-xs hidden-sm" style="margin-right: 24px;"> </div>
          </div>
        </div>
      </form>
      <!--Model Box Body End-->
    </div>
  </div>
  <!-- @*End:- PopUp Modal For Doctor and NMC in case of Narcotic sales (Narcotics Record)*@

@*Start:- PopUp Modal For Stock Details*@ -->

  <div class="popup-static portlet box portlet-fullscreen" *ngIf="showStockDetails">
    <div class="portlet-body form" style="background-color:white">
      <!--Model Box Body Start-->
      <div class="form-body">
        <div class="col-md-12">
          <div class="col-md-1 hidden-xs hidden-sm" style="margin-right: 24px;"> </div>
          <div class="col-md-10 col-sm-12 col-xs-12 modelbox-div" style="margin-right: 24px;">
            <div class="col-md-12">
              <div class="caption" style="color:blue; margin-top:10px;"> </div>
              <a style="float:right;  margin-top:-10px;" class="btn btn-danger" (click)="Close()" title="Cancel">X</a>
              <hr />
            </div>
            <div id="print-good-reciept" class="row printStyle print-border" style="margin-top: 50px;">
              <div style="text-align:left; margin-left:15px;">
                <div class="col-md-12">
                  <stock-list (on-closed)="Close()"> </stock-list>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-1 hidden-xs hidden-sm" style="margin-right: 24px;"> </div>
        </div>
      </div>
      <!--Model Box Body End-->
    </div>
  </div>

  <phrm-op-patient-add *ngIf="showAddNewOpPopUp" [showPopUp]="showAddNewOpPopUp" [patient-info]="currentPatient"
                       (call-back-close)="OnAddPatientPopUpClose($event)" (call-back-add-update)="OnNewPatientAdded($event)">
  </phrm-op-patient-add>


  <!--START:  Popup for show selected Invoice items details show -->
  <div class="popup-static portlet box portlet-fullscreen inv_modal" *ngIf="showSaleInvoice">
    <div class="portlet-body form">
      <div class="row">
        <div class="col-md-10 col-md-offset-1">
          <div class="modelbox-div clearfix">
            <a class="btn btn-danger history-del-btn" (click)="OnInvoicePopUpClose()" title="Cancel"><i class="fa fa-close"></i></a>
            <div class="form-body">
              <div class="col-md-12">
                <div class="row printStyle print-border">
                  <div style="text-align:center;">
                    <pharmacy-invoice-print [invoice-id]="currSale.InvoiceId" (call-back-print)="Close()">
                    </pharmacy-invoice-print>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!--END:  Popup for show selected Invoice items details show -->

  <!--START:  Popup for show invoice receipt -->
  <div class="popup-static portlet box portlet-fullscreen inv_modal" *ngIf="showProvisionalInvoice">
    <div class="portlet-body form">
      <div class="row">
        <div class="col-md-10 col-md-offset-1">
          <div class="modelbox-div clearfix">
            <a class="btn btn-danger history-del-btn" (click)="OnInvoicePopUpClose()" title="Cancel"><i class="fa fa-close"></i></a>
            <div class="form-body">
              <div class="col-md-12">
                <div class="row printStyle print-border">
                  <div style="text-align:center;">
                    <pharmacy-provisional-invoice-print [provisional-invoice]="ProvisionalInvoice">
                    </pharmacy-provisional-invoice-print>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!--END:  Popup for show invoice receipt -->

  <app-patient-deposit-add [showDepositAdd]="ShowDepositAdd" [deposit-data]="currentPatient" (callback-add)="DepositAdd()">
  </app-patient-deposit-add>

  <div class="popup-static portlet box portlet-fullscreen inv_modal" *ngIf="NMCNoAddPopup">
    <div class="portlet-body form">
      <div class="row">
        <div class="col-md-4 col-md-offset-4">
          <div class="modelbox-div clearfix">
            <div class="caption lb-caption no-margin">
              <h3>
                <span>Add Medical Certificate Number</span>
              </h3>
              <a class="btn btn-danger" (click)="CloseAddNMCPopup()" title="Cancel"><i class="fa fa-times"></i></a>
            </div>
            <form class="form-horizontal hm-form">
              <div class="form-body">
                <div class="form-group">
                  <label class="control-label col-md-5">Doctor Name<b>:</b></label>
                  <div class="col-md-7">
                    {{currSale.ReferrerName}}
                  </div>
                </div>
                <div class="form-group">
                  <label class="control-label col-md-5">{{GeneralFieldLabel.NMCNo}}<span style="color:red;">*</span><b>:</b></label>
                  <div class="col-md-7">
                    <input type="number" [(ngModel)]="MedicalCertificateNo" name="MedicalCertificateNo" id="MedicalCertificateNo">
                  </div>
                </div>
              </div>
              <div class="form-actions no-gutters">
                <div class="col-md-12" style="text-align:right">
                  <button style="margin-right: 10px;" type="button" class="btn green btn-success" (click)="SaveNMCNo()">Save</button>
                </div>
              </div>


            </form>
          </div>
        </div>
      </div>
    </div>
  </div>